-- ユーザーの基本情報を格納するテーブル
CREATE TABLE USERS (
    ID VARCHAR2(36) PRIMARY KEY, -- UUIDなどを想定
    DISPLAY_NAME VARCHAR2(255),
    PROFILE_IMAGE_URL VARCHAR2(2048),
    CREATED_AT TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 外部認証プロバイダーとの紐付けを管理するテーブル
CREATE TABLE USER_IDENTITIES (
    ID VARCHAR2(36) PRIMARY KEY,
    USER_ID VARCHAR2(36) NOT NULL,
    PROVIDER_NAME VARCHAR2(50) NOT NULL, -- 'google' など
    PROVIDER_USER_ID VARCHAR2(255) NOT NULL, -- Googleの'sub'クレーム
    ENCRYPTED_REFRESH_TOKEN VARCHAR2(2048), -- 暗号化して保存
    -- アクセストークンは有効期間が短いため、必要に応じてキャッシュなどに保存する方が望ましい場合もある
    -- ここでは例としてDBに含める
    ENCRYPTED_ACCESS_TOKEN VARCHAR2(2048),
    ACCESS_TOKEN_EXPIRES_AT TIMESTAMP,
    CONSTRAINT FK_USER_IDENTITIES_USER_ID FOREIGN KEY (USER_ID) REFERENCES USERS(ID),
    CONSTRAINT UK_USER_IDENTITIES_PROVIDER UNIQUE (PROVIDER_NAME, PROVIDER_USER_ID)
);